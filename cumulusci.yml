# Minimum required version of CumulusCI to run this project
minimum_cumulusci_version: "4.0.0"

#-------------------------#
# SCRATCH ORG DEFINITIONS #
#-------------------------#
# These are the different scratch org configurations available for development
# Each org has its own configuration file in the orgs/ directory and a specified duration
# The days parameter determines how long the scratch org will remain active

orgs:
  scratch:
    beta:
      config_file: orgs/beta.json
      days: 30
    dev-sb0:
      config_file: orgs/dev-sb0.json
      days: 30
    tfid:
      config_file: orgs/tfid.json
      days: 30
    tfid-cdo:
      config_file: orgs/tfid-cdo.json
      days: 30
    tfid-cdo-rlm:
      config_file: orgs/tfid-cdo-rlm.json
      days: 30
    tfid-qb-tso:
      config_file: orgs/tfid-qb-tso.json
      days: 30
    tfid-sdo:
      config_file: orgs/tfid-sdo.json
      days: 30
    tfid-dev:
      config_file: orgs/tfid-dev.json
      days: 30
    tfid-enable:
      config_file: orgs/tfid-enable.json
      days: 30
    dev_preview:
      config_file: orgs/dev_preview.json
      days: 30
    dev_previous:
      config_file: orgs/dev_previous.json
      days: 30
    dev_datacloud:
      config_file: orgs/dev_datacloud.json
      days: 30

# Project configuration settings
# Defines the project name, package details, and source format
project:
  name: rlm-base
  package:
    name: rlm-base
    api_version: "65.0"
  git:
    default_branch: "main"
  source_format: sfdx

#-----------------#
# CUSTOM SETTINGS #
#-----------------#
# These custom settings control feature flags and configuration options
# They are used throughout the deployment process to conditionally execute tasks
# Each setting can be toggled on/off to enable/disable specific features

  custom:
    prm: true                # Use Partner Relationship Management
    tso: true                # Is Trialforce Source Org?
    qb: true                 # Is QuantumBit?
    q3: false                # Include Q3 data
    calmdelete: true         # Use CALM Delete
    tax: true                # Use Tax engine
    billing: true            # Use Billing
    clm: false               # Use Contract Lifecycle Management
    dro: true                # Use Dynamic Revenue Orchestration
    rating: true             # Insert Rating Design Time Data
    rates: true              # Insert Rates
    ramps: true              # Insert and configure ramps
    einstein: true           # Use Einstein AI
    product_dataset: qb      # Default product dataset to use
    qbrix: true              # Use xDO base
    agents: true             # Deploy Agentforce Agent Configurations
    refresh: false           # Data refresh flag
    commerce: false          # Use Commerce
    quantumbit: true         # Use QuantumBit
    breconfig: false         # Business Rules Engine configuration
    docgen: true             # Use Document Generation
    psg_debug: false         # Debug Permission Set Groups
    pas_debug: false         # Debug Price Adjustment Schedules
    constraints: true        # Use Constraint Builder
    guidedselling: true      # Use Guided Selling
    procedureplans: false     # Use Procedure Plans

#------------------------------#
# PERMISSION SETS AND LICENSES #
#------------------------------#
# These sections define the permission sets and licenses that will be assigned
# based on the target org type and available features
# Each section is defined as a YAML anchor (&) for reuse throughout the file

    rlm_psl_api_names: &rlm_psl_api_names
      # Core RLM permission set licenses
      - BREDesigner
      - BRERuntime
      - ClauseManagementUser
      - ContractManagementUser
      - ContractsAIUserPsl
      - CorePricingDesignTime
      - DataProcessingEnginePsl
      - DecimalQuantityDesigntimePsl
      - DecimalQuantityRuntimePsl
      - DocGenDesignerPsl
      - DocumentBuilderUserPsl
      - DynamicRevenueOrchestratorUserPsl
      - IndustriesConfiguratorPsl
      - Microsoft365WordPsl
      - ObligationManagementUser
      - OmniStudioDesigner
      - ProductCatalogManagementAdministratorPsl
      - ProductDiscoveryUserPsl
      - RatingDesignTimePsl
      - RatingRunTimePsl
      - RevenueLifecycleManagementUserPsl
      - RevLifecycleMgmtBillingPsl
      - UsageDesignTimePsl
      - UsageRunTimePsl
      - WalletManagementUserPsl
      - BillingAdvancedPsl
      - IndustriesARCPsl
      - CollectionsAndRecoveryPsl

    rlm_ai_psg_api_names: &rlm_ai_psg_api_names
      # AI-related permission set groups
      - CopilotSalesforceUserPSG
      - CopilotSalesforceAdminPSG

    rlm_ai_psl_api_names: &rlm_ai_psl_api_names
      # AI-related permission set licenses
      - AgentforceServiceAgentBuilderPsl
      - AIAcceleratorPsl
      - EinsteinAnalyticsPlusPsl
      - EinsteinDisclsAndCmplHubUserPsl
      - EinsteinGPTCopilotPsl
      - EinsteinGPTPromptTemplatesPsl
      - MySearchPsl
      - RevenueIntelligencePsl
      - ScoringFrameworkPsl

    rlm_tableaunext_psl_api_names: &rlm_tableaunext_psl_api_names
      # Tableau-related permission set licenses
      - TableauEinsteinUserPsl

    rlm_tableaunext_ps_api_names: &rlm_tableaunext_ps_api_names
      # Tableau-related permission sets
      - TableauEinsteinAdmin
      - TableauEinsteinBusinessUser
      - TableauEinsteinAnalyst
      - TableauSelfServiceAnalyst

    rlm_ai_ps_api_names: &rlm_ai_ps_api_names
      # AI-related permission sets
      - EinsteinGPTPromptTemplateManager
      - SalesCloudEinsteinAll

    rlm_tso_psl_api_names: &rlm_tso_psl_api_names
      # Trialforce Source Org permission set licenses
      - AutomatedActionsPsl
      - EinsteinAgentCWUPsl
      - EinsteinAgentPsl
      - EinsteinCopilotReviewMyDayPsl
      - EinsteinDiscoveryInTableauPsl
      - EinsteinGPTCallExplorerPsl
      - EinsteinGPTCreateClosePlanPsl
      - EinsteinGPTGetProductPricingPsl
      - EinsteinGPTGroundingStructuredDataPsl
      - EinsteinGPTMeetingFollowUpPsl
      - EinsteinGPTSalesCallSummariesPsl
      - EinsteinGPTSalesEmailsPsl
      - EinsteinGPTSalesMiningPsl
      - EinsteinGPTSalesSummariesPsl
      - EinsteinGPTSendMeetingRequestPsl
      - EinsteinSalesGenerativeInsightsPsl
      - EinsteinSalesRepFeedbackPsl
      - ERIPlatformBasic
      - SalesActionFindPastCollaboratorsPsl
      - SalesActionReviewBuyingCommitteePsl
      - SalesCloudUnlimitedAnalyticsAdminPsl
      - SalesCloudUnlimitedPsl
      - SalesEngagementBasicPsl

    rlm_tso_psg_api_names: &rlm_tso_psg_api_names
      # Territory Sales Operations permission set groups
      - CopilotSalesforceUserPSG
      - CopilotSalesforceAdminPSG
      - UnifiedCatalogAdminPsl
      - UnifiedCatalogDesignerPsl

    rlm_tso_ps_api_names: &rlm_tso_ps_api_names
      # Territory Sales Operations permission sets
      - ERIBasic
      - RC_Utilities
      - OrchestrationProcessManagerPermissionSet
      - EventMonitoringPermSet
  
    rlm_pcm_ps_api_names: &rlm_pcm_ps_api_names
      # Product Catalog Management permission sets
      - IndustriesConfiguratorPlatformApi
      - ProductConfigurationRulesDesigner
      - ProductCatalogManagementAdministrator
      - ProductCatalogManagementViewer

    rlm_blng_ps_api_names: &rlm_blng_ps_api_names
      # Billing-related permission sets
      - AnalyticsStoreUser
      - RevenueLifecycleManagementAccountingAdmin
      - RevenueLifecycleManagementBillingAdmin
      - RevenueLifecycleManagementBillingCreateInvoiceFromBillingScheduleApi
      - RevenueLifecycleManagementBillingCreditMemoOperations
      - RevenueLifecycleManagementBillingInvoiceErrorRecoveryApi
      - RevenueLifecycleManagementBillingOperations
      - RevenueLifecycleManagementBillingTaxAdmin
      - RevenueLifecycleManagementBillingVoidPostedInvoiceApi
      - RevenueLifecycleManagementCreateBillingScheduleFromBillingTransactionApi

    rlm_clm_psl_api_names: &rlm_clm_psl_api_names
      # Contract Lifecycle Management permission set licenses
      - ClauseManagementUser
      - CLMAnalyticsPsl
      - ContractManagementUser
      - ContractsAIUserPsl
      - DisclosureAndComplianceHubUserPsl
      - DocGenDesignerPsl
      - DocumentBuilderUserPsl
      - InsightsCGAnalyticsPsl
      - Microsoft365WordPsl
      - NLPServicePsl
      - ObligationManagementUser
      - OmniStudioDesigner
      - ScoringFrameworkPsl

    rlm_psg_api_names: &rlm_psg_api_names
      # Core permission set groups
      - RC_QB_AI
      - RC_RCB
      - RC_RMI
      - RLM_CFG
      - RLM_CLM
      - RLM_DOC
      - RLM_DRO
      - RLM_NGP
      - RLM_PCM
      - RLM_PSL
      - RLM_USG
      
    ps_quantumbit: &ps_quantumbit
      # QuantumBit-specific permission sets
      - RLM_QuantumBit

    ps_calmdelete: &ps_calmdelete
      # CALM Delete-specific permission sets
      - RLM_CALM_SObject_Access

    ps_aea: &ps_aea
      # Agent-specific permission sets
      - RLM_Revenue_Cloud_Agent

    ps_procedureplans: &ps_procedureplans
      # Procedure Plans-specific permission sets
      - RLM_ProcedurePlans

#-----------------#
# DECISION TABLES #
#-----------------#
# These sections define the decision tables that need to be refreshed during deployment
# Each section is defined as a YAML anchor (&) for reuse throughout the file
# Decision tables are used for business logic and rule processing

    dt_rating_decision_tables: &dt_rating_decision_tables
      # Core rating decision tables for asset and binding object rate calculations
      - Asset_Action_Source_Entries_Decision_Table_V2
      - Asset_Rate_Card_Entry_Resolution_V2
      - Asset_Rate_Card_Entry_Resolution_Entries
      - Asset_Rate_Decision_Table_V2
      - Asset_Rate_Adjustment_Resolution_Entries
      - Asset_Tier_based_Rate_Adjustmen_V2
      - Asset_Volume_based_Rate_Adjustment_V2
      - Attribute_based_Rate_Adjustment_by_Rate_Card_Entry_ID
      - Binding_Object_Rate_Card_Entry_Resolution_V2
      - Binding_Object_Rate_Card_Entry_Resolution_Entries_v2
      - Binding_Object_Rate_Decision_Table_V2
      - Binding_Object_Rate_Adjustment_Resolution_Entries
      - Binding_Object_Tier_based_Rate_Adjustment_V2
      - Binding_Object_Volume_based_Rate_Adjustment_V2
      - Commitment_based_Rate_Adjustment
      - Rate_Adjustment_by_Attribute_Entries_2
      - Rate_Adjustment_by_Tier_Entries_2
      - Rate_Adjustment_by_Volume_Entries_2
      - Rate_Card_Entries_2
      - Tier_based_Rate_Adjustment_by_Rate_Card_Entry_ID
      - Volume_based_Rate_Adjustment_by_Rate_Card_Entry_ID
      - Index_Rate_Decision_Table

    dt_rating_discovery_decision_tables: &dt_rating_discovery_decision_tables
      # Decision tables used for rating discovery and resolution
      - Binding_Object_Rate_Adjustment_Resolution_Entries
      - Binding_Object_Rate_Card_Entry_Resolution_Entries_V2
      - Pricebook_Rate_Card_Decision_Table
      - Rate_Adjustment_by_Attribute_Resolution_Decision_Table
      - Rate_Adjustment_by_Tier_Resolution_Decision_Table
      - Rate_Card_Entry_Resolution_Entries_2

    dt_default_pricing_decision_tables: &dt_default_pricing_decision_tables
      # Default pricing decision tables for contract and price adjustments
      - Attribute_Based_Adjustment_Decision_Table
      - Bundle_Based_Adjustment_Decision_Table
      - Contract_Pricing_Adjustment_Tiers
      - Contract_Pricing_Entries_Decision_Table
      - Contract_Pricing_Volume_Tiers
      - Price_Adjustment_Tier_Decision_Table
      - Price_Book_Entry_Decision_Table_v2
      - Tiered_Adjustment_Tier_Decision_Table
      - Product_Price_Range_Entries_Decision_Table
      - Product_Price_Range_Entries_Decision_Table_v2

    dt_asset_decision_tables: &dt_asset_decision_tables
      # Asset-specific decision tables for rate calculations and adjustments
      - Asset_Action_Source_Entries_Decision_Table_V2
      - Asset_Rate_Card_Entry_Resolution_V2
      - Asset_Rate_Decision_Table_V2
      - Asset_Tier_based_Rate_Adjustment_V2
      - Asset_Volume_based_Rate_Adjustment_V2
      - Asset_Rate_Adjustment_Resolution_Entries
      - Asset_Rate_Card_Entry_Resolution_Entries
      - Commitment_based_Rate_Adjustment

    dt_pricing_discovery_decision_tables: &dt_pricing_discovery_decision_tables
      # Decision tables used for pricing discovery and derived pricing
      - Asset_Action_Source_Entries_Decision_Table_V2
      - Derived_Pricing_Entries_Decision_Table
      - Product_Price_Range_Entries_Decision_Table
      - Product_Price_Range_Entries_Decision_Table_v2

#-----------------------------#
# CONTEXT DEFINITION SETTINGS #
#-----------------------------#
# These sections define the context definitions used in the deployment process
# Each context has a name, default mapping, and base reference
# Contexts are used to manage data relationships and business logic

    default_context_start_date: &default_context_start_date "2020-01-01T00:00:00.000Z"
    default_context_ttl: &default_context_ttl 30

    asset_context_name: &asset_context_name RLM_AssetContext
    asset_context_default_mapping: &asset_context_default_mapping AssetEntitiesMapping
    asset_context_base_reference: &asset_context_base_reference AssetContext__stdctx

    sales_transaction_context_name: &sales_transaction_context_name RLM_SalesTransactionContext
    sales_transaction_context_default_mapping: &sales_transaction_context_default_mapping QuoteEntitiesMapping
    sales_transaction_context_base_reference: &sales_transaction_context_base_reference SalesTransactionContext__stdctx

    product_discovery_context_name: &product_discovery_context_name RLM_ProductDiscoveryContext
    product_discovery_context_default_mapping: &product_discovery_context_default_mapping ProductDiscoveryMapping
    product_discovery_context_base_reference: &product_discovery_context_base_reference ProductDiscoveryContext__stdctx

    cart_context_name: &cart_context_name RLM_CommerceCartContext
    cart_context_default_mapping: &cart_context_default_mapping CommerceCartMapping
    cart_context_base_reference: &cart_context_base_reference CommerceCartContextDefinition__stdctx

    billing_context_name: &billing_context_name RLM_BillingContext
    billing_context_default_mapping: &billing_context_default_mapping BSGEntitiesMapping
    billing_context_base_reference: &billing_context_base_reference BillingContext__stdctx

    fulfillment_asset_context_name: &fulfillment_asset_context_name RLM_FulfillmentAssetContext
    fulfillment_asset_context_default_mapping: &fulfillment_asset_context_default_mapping FulfillAssetEntitiesMapping
    fulfillment_asset_context_base_reference: &fulfillment_asset_context_base_reference FulfillmentAssetContext__stdctx

    contracts_context_name: &contracts_context_name RLM_ContractsContext
    contracts_context_default_mapping: &contracts_context_default_mapping OppToCntrPersistenceMapping
    contracts_context_base_reference: &contracts_context_base_reference ContractsContextDefinition__stdctx

    contracts_extraction_context_name: &contracts_extraction_context_name RLM_ContractsExtractionContext
    contracts_extraction_context_default_mapping: &contracts_extraction_context_default_mapping DocExtrctPersistenceMapping
    contracts_extraction_context_base_reference: &contracts_extraction_context_base_reference ContractsExtractionContext__stdctx

    collection_plan_segment_context_name: &collection_plan_segment_context_name RLM_CollectionPlanSegmentCtx
    collection_plan_segment_context_default_mapping: &collection_plan_segment_context_default_mapping CollectionPlanContextMapping
    collection_plan_segment_context_base_reference: &collection_plan_segment_context_base_reference CollectionPlanSegmentContext__stdctx

    rate_management_context_name: &rate_management_context_name RLM_RateManagementContext
    rate_management_context_default_mapping: &rate_management_context_default_mapping DefaultUsageMapping
    rate_management_context_base_reference: &rate_management_context_base_reference RateManagementContext__stdctx

    rating_discovery_context_name: &rating_discovery_context_name RLM_RatingDiscoveryContext
    rating_discovery_context_default_mapping: &rating_discovery_context_default_mapping CatalogMapping
    rating_discovery_context_base_reference: &rating_discovery_context_base_reference RatingDiscoveryContext__stdctx

#------------------------------------#
# DATA PLAN NAMES AND PATHS SETTINGS #
#------------------------------------#
# These anchors define the paths to various datasets used for data loading tasks
# Each dataset is referenced in the data load tasks to insert or update data in the org
# The datasets are organized by feature (QuantumBit, Q3, etc.) and data type (product, billing, etc.)

    quantumbit_product_dataset: &quantumbit_product_dataset "datasets/sfdmu/qb-multicurrency"         # QuantumBit product data
    quantumbit_billing_dataset: &quantumbit_billing_dataset "datasets/sfdmu/qb-billing"               # QuantumBit billing data
    quantumbit_dro_dataset: &quantumbit_dro_dataset "datasets/sfdmu/qb-dro"                           # QuantumBit DRO data
    quantumbit_tax_dataset: &quantumbit_tax_dataset "datasets/sfdmu/qb-tax"                           # QuantumBit tax data
    quantumbit_rating_dataset: &quantumbit_rating_dataset "datasets/sfdmu/qb-rating-256"              # QuantumBit rating data
    quantumbit_rates_dataset: &quantumbit_rates_dataset "datasets/sfdmu/qb-rates"                     # QuantumBit rates data
    quantumbit_constraints_product_dataset: &quantumbit_constraints_product_dataset "datasets/sfdmu/qb-constraints-product"   # QuantumBit constraints product data
    quantumbit_constraints_component_dataset: &quantumbit_constraints_component_dataset "datasets/sfdmu/qb-constraints-component" # QuantumBit constraints component data
    quantumbit_guidedselling_dataset: &quantumbit_guidedselling_dataset "datasets/sfdmu/qb-guidedselling" # QuantumBit guided selling data

    q3_product_dataset: &q3_product_dataset "datasets/sfdmu/q3-multicurrency"                         # Q3 product data
    q3_billing_dataset: &q3_billing_dataset "datasets/sfdmu/q3-billing"                               # Q3 billing data
    q3_dro_dataset: &q3_dro_dataset "datasets/sfdmu/q3-dro"                                           # Q3 DRO data
    q3_tax_dataset: &q3_tax_dataset "datasets/sfdmu/q3-tax"                                           # Q3 tax data
    q3_rating_dataset: &q3_rating_dataset "datasets/sfdmu/q3-rating-256"                              # Q3 rating data
    q3_rates_dataset: &q3_rates_dataset "datasets/sfdmu/q3-rates"                                     # Q3 rates data
    q3_constraints_product_dataset: &q3_constraints_product_dataset "datasets/sfdmu/q3-constraints-product"   # Q3 constraints product data
    q3_constraints_component_dataset: &q3_constraints_component_dataset "datasets/sfdmu/q3-constraints-component" # Q3 constraints component data
    q3_guidedselling_dataset: &q3_guidedselling_dataset "datasets/sfdmu/q3-guidedselling"             # Q3 guided selling data

    sleep_default: &sleep_default 30   # Default sleep duration (in seconds) for wait tasks
#-------#
# TASKS #
#-------#

tasks:
  robot:
    options:
      suites: robot/rlm-base/tests
      options:
        outputdir: robot/rlm-base/results

  robot_testdoc:
    options:
      path: robot/rlm-base/tests
      output: robot/rlm-base/doc/rlm-base_tests.html

  run_tests:
    options:
      required_org_code_coverage_percent: 75

#--------------------------#
# CONTEXT DEFINITION TASKS #
#--------------------------#
  extend_context_contracts:
    description: Extend Standard Contracts Context Definition
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    group: Revenue Lifecycle Management
    options:
      name: *contracts_context_name
      description: "Extension of Standard Contracts Context Definition"
      developerName: *contracts_context_name
      baseReference: *contracts_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *contracts_context_default_mapping
      activate: true

  extend_context_contracts_extraction:
    description: Extend Standard Contracts Extraction Context Definition
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    group: Revenue Lifecycle Management
    options:
      name: *contracts_extraction_context_name
      description: "Extension of Standard Contracts Extraction Context Definition"
      developerName: *contracts_extraction_context_name
      baseReference: *contracts_extraction_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *contracts_extraction_context_default_mapping
      activate: true

  extend_context_asset:
    group: Revenue Lifecycle Management
    description: Extend Standard Asset Context
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *asset_context_name
      description: "Extension of Standard Sales Transaction Context Definition"
      developerName: *asset_context_name
      baseReference: *asset_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *asset_context_default_mapping
      activate: true

  extend_context_sales_transaction:
    group: Revenue Lifecycle Management
    description: Extend Standard Sales Transaction Context
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *sales_transaction_context_name
      description: "Extension of Standard Sales Transaction Context Definition"
      developerName: *sales_transaction_context_name
      baseReference: *sales_transaction_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *sales_transaction_context_default_mapping
      activate: true

  extend_context_product_discovery:
    description: Extend Standard Product Discovery Context
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *product_discovery_context_name
      description: "Extension of Standard Product Discovery Context Definition"
      developerName: *product_discovery_context_name
      baseReference: *product_discovery_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *product_discovery_context_default_mapping
      activate: true

  extend_context_cart:
    description: Extend Standard Cart Context
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *cart_context_name
      description: "Extension of Standard Cart Context Definition"
      developerName: *cart_context_name
      baseReference: *cart_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *cart_context_default_mapping  
      activate: true

  extend_context_billing:
    description: Extend Standard Billing Context
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *billing_context_name
      description: "Extension of Standard Billing Context Definition"
      developerName: *billing_context_name
      baseReference: *billing_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *billing_context_default_mapping
      activate: true

  extend_context_fulfillment_asset:
    description: Extend Standard Fulfillment Asset Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *fulfillment_asset_context_name
      description: "Extension of Standard Fulfillment Asset Context Definition"
      developerName: *fulfillment_asset_context_name
      baseReference: *fulfillment_asset_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *fulfillment_asset_context_default_mapping
      activate: true

  extend_context_collection_plan_segment:
    description: Extend Standard Collection Plan Segment Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *collection_plan_segment_context_name
      description: "Extension of Standard Collection Plan Segment Context Definition"
      developerName: *collection_plan_segment_context_name
      baseReference: *collection_plan_segment_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *collection_plan_segment_context_default_mapping
      activate: true

  extend_context_rate_management:
    description: Extend Standard Rate Management Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *rate_management_context_name
      description: "Extension of Standard Rate Management Context Definition"
      developerName: *rate_management_context_name
      baseReference: *rate_management_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *rate_management_context_default_mapping
      activate: true

  extend_context_rating_discovery:
    description: Extend Standard Rating Discovery Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *rating_discovery_context_name
      description: "Extension of Standard Rating Discovery Context Definition"
      developerName: *rating_discovery_context_name
      baseReference: *rating_discovery_context_base_reference
      startDate: *default_context_start_date
      contextTtl: *default_context_ttl
      defaultMapping: *rating_discovery_context_default_mapping
      activate: true

#--------------#
# DEPLOY TASKS #
#--------------#
# All deploy tasks are managed here and can be called in any order
# TODO: Organize pre/post deploy tasks into their own sections

  deploy_context_definitions:
    description: Deploy Context Definitions
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/contextDefinitions

  deploy_permissions:
    description: Deploy Permission Set Groups
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/permissionsetgroups

  deploy_decision_tables:
    description: Deploy Decision Tables
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/decisionTables

  deploy_agents_bots:
    description: Deploy Agentforce Agent Bots
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/bots

  deploy_agents_genAiPlanners:
    description: Deploy Agentforce Agent Planner Bundles
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/genAiPlannerBundles

  deploy_agents_genAiFunctions:
    description: Deploy Agentforce Agent Functions
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/genAiFunctions

  deploy_agents_genAiPlugins:
    description: Deploy Agentforce Agent Plugins
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/genAiPlugins

  deploy_agents_flows:
    description: Deploy Agentforce Agent Flows
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/flows

  deploy_agents_settings:
    description: Deploy Agentforce Agent Settings
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/settings

  deploy_agents_permissionsets:
    description: Deploy Agentforce Agent Permissionsets
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/permissionsets
  
  deploy_agents:
    description: Deploy Agentforce Agent Configurations
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents

  deploy_sharing_rules:
    description: Deploy Sharing Rules
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_sharing

  deploy_quantumbit:
    description: Deploy QuantumBit Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_quantumbit

  deploy_post_scratch:
    description: Deploy Scratch Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_scratch

  deploy_post_tso:
    description: Deploy Trialforce Source Org Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_tso

  deploy_post_prm:
    description: Deploy Partner Relationship Management Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_prm

  deploy_post_docgen:
    description: Deploy Document Generation Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_docgen

  deploy_post_constraints:
    description: Deploy Constraints Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_constraints

  deploy_post_utils:
    description: Deploy Utils Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_utils

  deploy_post_procedureplans:
    description: Deploy Procedure Plans Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_procedureplans
  
  deploy_post_procedureplans_objects:
    description: Deploy Procedure Plans Objects
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_procedureplans/objects

  deploy_post_procedureplans_classes:
    description: Deploy Procedure Plans Classes
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_procedureplans/classes

  deploy_post_procedureplans_permissionsets:
    description: Deploy Procedure Plans Permissionsets
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_procedureplans/permissionsets

  deploy_post_billing:
    description: Deploy Billing Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_billing

  deploy_post_guidedselling:
    description: Deploy Guided Selling Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_guidedselling

  deploy_post_payments:
    description: Deploy Payments Metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    options:
      path: unpackaged/post_payments

  deploy_expression_sets:
    description: Deploy Expression Sets
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/expressionSetDefinition
      transforms:
        - transform: find_replace
          options:
            patterns:
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__ATTRIBUTEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Attribute Based Adjustment' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__VOLUMEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Price Adjustment Tier' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__BUNDLEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Bundle Based Adjustment' LIMIT 1
                api: rest

  activate_and_deploy_expression_sets:
    description: Activate and Deploy Expression Sets
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/expressionSetDefinition
      transforms:
        - transform: find_replace
          options:
            patterns:
              - xpath: //ExpressionSetDefinition/versions/status[text()="Draft"]
                replace: Active
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__ATTRIBUTEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Attribute Based Adjustment' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__VOLUMEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Price Adjustment Tier' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__BUNDLEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Bundle Based Adjustment' LIMIT 1
                api: rest

  deploy_full:
    description: Deploy all metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default
      transforms:
        - transform: find_replace
          options:
            patterns:
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__ATTRIBUTEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Attribute Based Adjustment' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__VOLUMEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Price Adjustment Tier' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__BUNDLEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Bundle Based Adjustment' LIMIT 1
                api: rest

  deploy_org_settings:
    description: Deploy Org Settings
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/settings

  create_partner_central:
    description: Create Partner Central Community
    class_path: cumulusci.tasks.salesforce.CreateCommunity
    options:
      name: "rlm"
      description: "RLM Partner Digital Experience"
      template: "Build Your Own"
      skip_existing: true


#------------------#
# SFDMU DATA TASKS #
#------------------#
# These tasks use the SFDMU (Salesforce Data Move Utility) to load data into the org.
# Each task references a dataset anchor defined earlier, specifying the path to the data to load.
# Data tasks are grouped by feature (QuantumBit, Q3, CLM, etc.) and data type (product, billing, tax, etc.).
# These tasks are essential for seeding orgs with test or reference data during deployment.

  load_sfdmu_data:
    group: Revenue Lifecycle Management
    description: Load SFDMU Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData

  insert_quantumbit_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_product_dataset

  insert_quantumbit_data_prod:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_product_dataset

  insert_q3_data:
    group: Revenue Lifecycle Management
    description: Insert Q3 Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_product_dataset

  insert_q3_data_prod:
    group: Revenue Lifecycle Management
    description: Insert Q3 Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_product_dataset

  insert_clm_data:
    group: Revenue Lifecycle Management
    description: Insert CLM Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/test-clm"

  insert_clm_data_prod:
    group: Revenue Lifecycle Management
    description: Insert CLM Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/clm"

  insert_qb_dro_data_scratch:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit DRO Data to Scratch
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/qb-dro_scratch"

  insert_qb_dro_data_prod:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit DRO Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_dro_dataset

  insert_q3_dro_data_scratch:
    group: Revenue Lifecycle Management
    description: Insert Q3 DRO Data to Scratch
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-dro_scratch"

  insert_q3_dro_data_prod:
    group: Revenue Lifecycle Management
    description: Insert Q3 DRO Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_dro_dataset

  insert_tax_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Tax Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_tax_dataset

  insert_tax_data_prod:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Tax Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_tax_dataset

  insert_q3_tax_data:
    group: Revenue Lifecycle Management
    description: Insert Q3 Tax Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_tax_dataset

  insert_q3_tax_data_prod:
    group: Revenue Lifecycle Management
    description: Insert Q3 Tax Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_tax_dataset

  insert_billing_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Billing Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_billing_dataset

  insert_billing_data_prod:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Billing Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_billing_dataset

  insert_q3_billing_data:
    group: Revenue Lifecycle Management
    description: Insert Q3 Billing Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_billing_dataset

  insert_q3_billing_data_prod:
    group: Revenue Lifecycle Management
    description: Insert Q3 Billing Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_billing_dataset

  insert_qb_rating_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Rating Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rating_dataset

  insert_qb_rating_data_prod:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Rating Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rating_dataset
  
  insert_q3_rating_data:
    group: Revenue Lifecycle Management
    description: Insert Q3 Rating Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_rating_dataset

  insert_q3_rating_data_prod:
    group: Revenue Lifecycle Management
    description: Insert Q3 Rating Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_rating_dataset

  insert_qb_rates_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Rates Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rates_dataset

  insert_qb_rates_data_prod:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Rates Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rates_dataset

  insert_q3_rates_data:
    group: Revenue Lifecycle Management
    description: Insert Q3 Rates Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_rates_dataset

  insert_q3_rates_data_prod:
    group: Revenue Lifecycle Management
    description: Insert Q3 Rates Data to Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *q3_rates_dataset

  insert_scratch_data:
    group: Revenue Lifecycle Management
    description: Insert Scratch Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/scratch_data"

  insert_qb_constraints_product_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Constraints Product Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_constraints_product_dataset

  insert_qb_constraints_component_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Constraints Product Related Component Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_constraints_component_dataset

  insert_qb_guidedselling_data:
    group: Revenue Lifecycle Management
    description: Insert QuantumBit Guided Selling Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_guidedselling_dataset
  
  activate_decision_tables:
    group: Revenue Lifecycle Management
    description: Activate Decision Tables
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/decision_tables_active"

  activate_expression_sets:
    group: Revenue Lifecycle Management
    description: Activate Expression Sets
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_active"

  activate_expression_sets_prod:
    group: Revenue Lifecycle Management
    description: Activate Expression Sets in Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_active"

  deactivate_expression_sets:
    group: Revenue Lifecycle Management
    description: Deactivate Expression Sets
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_inactive"

  deactivate_expression_sets_prod:
    group: Revenue Lifecycle Management
    description: Deactivate Expression Sets in Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_inactive"

  create_price_adjustment_schedules:
    group: Revenue Lifecycle Management
    description: Create Price Adjustment Schedules
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/pas"

  create_price_adjustment_schedules_prod:
    group: Revenue Lifecycle Management
    description: Create Price Adjustment Schedules in Production
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/pas"

#------------#
# APEX TASKS #
#------------#
# These tasks execute anonymous Apex scripts to perform setup or data manipulation in the org.
# Each task references a script in the scripts/apex directory.
# These are typically used for post-deployment configuration, data activation, or custom logic.

  create_rule_library:
    group: Revenue Lifecycle Management
    description: Create Rule Library
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createRuleLibrary.apex

  create_docgen_library:
    group: Revenue Lifecycle Management
    description: Create DocGen Library
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createDocgenTemplateLibrary.apex

  create_dro_rule_library:
    group: Revenue Lifecycle Management
    description: Create DRO Rule Library
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createDRORuleLibrary.apex

  create_tax_engine:
    group: Revenue Lifecycle Management
    description: Create Tax Engine
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createTaxEngine.apex

  activate_default_payment_term:
    group: Revenue Lifecycle Management
    description: Activate Default Payment Term
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateDefaultPaymentTerm.apex

  activate_billing_records:
    group: Revenue Lifecycle Management
    description: Activate Billing Records
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateBillingRecords.apex

  activate_tax_records:
    group: Revenue Lifecycle Management
    description: Activate Tax Records
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateTaxRecords.apex

  activate_price_adjustment_schedules:
    group: Revenue Lifecycle Management
    description: Activate Price Adjustment Schedules
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activatePriceAdjustmentSchedules.apex

  activate_rating_records:
    group: Revenue Lifecycle Management
    description: Activate Rating Records
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateRatingRecords.apex

  activate_rates:
    group: Revenue Lifecycle Management
    description: Activate Rates
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateRateCardEntries.apex

#------------------#
# PYTHON CCI TASKS #
#------------------#
# These tasks are custom Python tasks implemented in the tasks/ directory.
# They are used for advanced automation, data refresh, and business logic not covered by standard CumulusCI tasks.
# Each task references a class_path to a Python class that implements the logic.

  sync_pricing_data:
    description: Sync Pricing Data
    class_path: tasks.rlm_sync_pricing_data.SyncPricingData
    group: Revenue Lifecycle Management

  refresh_dt_rating:
    group: Revenue Lifecycle Management
    description: Refresh Rating Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_rating_decision_tables

  refresh_dt_rating_discovery:
    group: Revenue Lifecycle Management
    description: Refresh Rating Discovery Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_rating_discovery_decision_tables

  refresh_dt_default_pricing:
    group: Revenue Lifecycle Management
    description: Refresh Default Pricing Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_default_pricing_decision_tables

  refresh_dt_pricing_discovery:
    group: Revenue Lifecycle Management
    description: Refresh Pricing Discovery Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_pricing_discovery_decision_tables

  refresh_dt_asset:
    group: Revenue Lifecycle Management
    description: Refresh Asset Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_asset_decision_tables

#----------------#
# MAIN CCI FLOWS #
#----------------#
# This section defines the main CumulusCI flows for this project.
# Flows are ordered sequences of tasks and/or sub-flows that automate complex deployment and setup processes.
# Each flow is grouped by feature or deployment phase, and steps can include conditional logic (when) to control execution.
# The main flow (prepare_rlm_org) orchestrates the full org setup, calling other flows and tasks in a specific order.

flows:
  prepare_rlm_org:
    group: Revenue Lifecycle Management
    steps:
      1:
        flow: prepare_core
      2:
        flow: prepare_decision_tables
      4:
        flow: prepare_expression_sets
      5:
        task: create_partner_central
        when: project_config.project__custom__prm
      6:
        task: deploy_full
      7:
        flow: prepare_price_adjustment_schedules
      8:
        flow: prepare_scratch
      9:
        flow: prepare_quantumbit
      10:
        flow: prepare_product_data
      11:
        flow: prepare_dro
      12:
        flow: prepare_tax
      13:
        flow: prepare_billing
      14:
        flow: prepare_clm
      15:
        flow: prepare_rating
      16:
        task: activate_and_deploy_expression_sets
      17:
        flow: prepare_tso
      18:
        flow: prepare_procedureplans
      19:
        flow: prepare_prm
      20:
        flow: prepare_agents
      21:
        flow: prepare_docgen
      22:
        flow: prepare_constraints
      23:
        flow: prepare_guidedselling
      24:
        flow: refresh_all_decision_tables
         
  prepare_core:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: assign_permission_set_licenses
        options:
          api_names: *rlm_psl_api_names
      2:
        task: deploy_pre
      3:
        task: assign_permission_set_licenses
        when: project_config.project__custom__clm
        options:
          api_names: *rlm_clm_psl_api_names
      4:
        task: assign_permission_set_licenses
        when: project_config.project__custom__einstein
        options:
          api_names: *rlm_ai_psl_api_names  
      5:
        task: util_sleep
        options:
          seconds: *sleep_default
      6:
        task: assign_permission_set_groups
        options:
          api_names: *rlm_psg_api_names
      7:
        task: assign_permission_sets
        when: project_config.project__custom__tso and project_config.project__custom__psg_debug
        options:
          api_names: *rlm_pcm_ps_api_names
      8:
        flow: extend_context_definitions
      9:
        task: util_sleep
        options:
          seconds: *sleep_default
      10:
        task: create_price_adjustment_schedules
        when: org_config.scratch and project_config.project__custom__pas_debug 
      11:
        task: create_price_adjustment_schedules_prod
        when: not org_config.scratch and project_config.project__custom__tso and project_config.project__custom__pas_debug
      12:
        task: util_sleep
        when: project_config.project__custom__pas_debug 
        options:
          seconds: *sleep_default
      13:
        task: create_rule_library
        when: project_config.project__custom__breconfig
      14:
        task: util_sleep
        when: project_config.project__custom__breconfig
        options:
          seconds: *sleep_default
      15:
        task: create_dro_rule_library
        when: project_config.project__custom__dro and project_config.project__custom__breconfig
      16:
        task: assign_permission_sets
        when: project_config.project__custom__einstein
        options:
          api_names: *rlm_ai_ps_api_names
      17:
        task: assign_permission_sets
        when: project_config.project__custom__billing and project_config.project__custom__psg_debug
        options:
          api_names: *rlm_blng_ps_api_names

  extend_context_definitions:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: extend_context_sales_transaction
      2:
        task: extend_context_product_discovery
      3:
        task: extend_context_cart
        when: project_config.project__custom__commerce
      4:
        task: extend_context_billing
        when: project_config.project__custom__billing
      5:
        task: extend_context_collection_plan_segment
        when: project_config.project__custom__billing
      6:
        task: extend_context_fulfillment_asset
        when: project_config.project__custom__dro
      7:
        task: extend_context_contracts
        when: project_config.project__custom__clm
      8:
        task: extend_context_contracts_extraction
        when: project_config.project__custom__clm
      9:
        task: extend_context_rate_management
        when: project_config.project__custom__rating
      10:
        task: extend_context_rating_discovery
        when: project_config.project__custom__rating
      11:
        task: extend_context_asset

  prepare_expression_sets:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deactivate_expression_sets
        when: org_config.scratch
      2:
        task: deactivate_expression_sets_prod
        when: not org_config.scratch
      3:
        task: deploy_expression_sets
        when: org_config.scratch
  
  prepare_product_data:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_quantumbit_data
        when: org_config.scratch and project_config.project__custom__qb
      2:
        task: insert_quantumbit_data_prod
        when: not org_config.scratch and project_config.project__custom__qb
      3:
        task: insert_q3_data
        when: org_config.scratch and project_config.project__custom__q3
      4:
        task: insert_q3_data_prod
        when: not org_config.scratch and project_config.project__custom__q3

  prepare_scratch:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_scratch_data
        when: org_config.scratch and not project_config.project__custom__tso
      2:
        task: deploy_post_scratch
        when: org_config.scratch and not project_config.project__custom__tso

  prepare_quantumbit:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deploy_quantumbit
        when: project_config.project__custom__quantumbit
      2:
        task: assign_permission_sets
        when: project_config.project__custom__quantumbit
        options:
          api_names: *ps_quantumbit
      3:
        task: assign_permission_sets
        when: project_config.project__custom__quantumbit and project_config.project__custom__calmdelete
        options:
          api_names: *ps_calmdelete

  prepare_tso:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: assign_permission_set_licenses
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_tso_psl_api_names
      2:
        task: assign_permission_set_groups
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_tso_psg_api_names
      3:
        task: deploy_post_utils
        when: project_config.project__custom__tso
      4:
        task: deploy_post_tso
        when: project_config.project__custom__tso
      5:
        task: assign_permission_sets
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_tso_ps_api_names

  prepare_dro:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_qb_dro_data_scratch
        when: org_config.scratch and project_config.project__custom__dro and project_config.project__custom__qb
      2:
        task: insert_qb_dro_data_prod
        when: not org_config.scratch and project_config.project__custom__dro and project_config.project__custom__qb
      3:
        task: insert_q3_dro_data_scratch
        when: org_config.scratch and project_config.project__custom__dro and project_config.project__custom__q3
      4:
        task: insert_q3_dro_data_prod
        when: not org_config.scratch and project_config.project__custom__dro and project_config.project__custom__q3

  prepare_clm:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_clm_data
        when: org_config.scratch and project_config.project__custom__clm
      2:
        task: insert_clm_data_prod
        when: not org_config.scratch and project_config.project__custom__clm

  prepare_docgen:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: create_docgen_library
        when: project_config.project__custom__docgen
      2:
        task: deploy_post_docgen
        when: project_config.project__custom__docgen

  prepare_billing:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_billing_data
        when: org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__qb
      2:
        task: insert_billing_data_prod
        when: not org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__qb
      3:
        task: insert_q3_billing_data
        when: org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__q3
      4:
        task: insert_q3_billing_data_prod
        when: not org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__q3
      5:
        task: activate_flow
        when: project_config.project__custom__billing
        options:
          developer_names: RLM_Order_to_Billing_Schedule_Flow
      6:
        task: activate_default_payment_term
        when: project_config.project__custom__billing
      7: 
        task: activate_billing_records
        when: project_config.project__custom__billing
      8:
        task: deploy_post_billing
        when: project_config.project__custom__billing

  prepare_prm:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deploy_post_prm
        when: project_config.project__custom__prm
      2:
        task: publish_community
        when: project_config.project__custom__prm
        options:
          name: rlm
      3:
        task: deploy_sharing_rules
        when: project_config.project__custom__prm

  prepare_tax:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: create_tax_engine
        when: project_config.project__custom__tax
      2:
        task: insert_tax_data
        when: org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__qb
      3:
        task: insert_tax_data_prod
        when: not org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__qb
      4:
        task: insert_q3_tax_data
        when: org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__q3
      5:
        task: insert_q3_tax_data_prod
        when: not org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__q3
      6: 
        task: activate_tax_records
        when: project_config.project__custom__tax

  prepare_rating:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_qb_rating_data
        when: org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__qb
      2:
        task: insert_qb_rating_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__qb
      3:
        task: insert_q3_rating_data
        when: org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__q3
      4:
        task: insert_q3_rating_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__q3
      5:
        task: insert_qb_rates_data
        when: org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__qb
      6:
        task: insert_qb_rates_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__qb
      7:
        task: insert_q3_rates_data
        when: org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__q3
      8:
        task: insert_q3_rates_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__q3
      9: 
        task: activate_rating_records
        when: project_config.project__custom__rating and project_config.project__custom__rates
      10: 
        task: activate_rates
        when: project_config.project__custom__rating and project_config.project__custom__rates
  
  prepare_agents:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: assign_permission_set_groups
        when: project_config.project__custom__agents
        options:
          api_names: *rlm_ai_psg_api_names
      2:
        task: deploy_agents_settings
        when: project_config.project__custom__agents
      3:
        task: deploy_agents
        when: project_config.project__custom__agents
      4:
        task: assign_permission_sets
        when: project_config.project__custom__agents
        options:
          api_names: *ps_aea
  
  refresh_all_decision_tables:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: sync_pricing_data
      2:
        task: refresh_dt_pricing_discovery
      3:
        task: refresh_dt_asset
        when: project_config.project__custom__rating
      4:
        task: refresh_dt_rating
        when: project_config.project__custom__rating
      5:
        task: refresh_dt_rating_discovery
        when: project_config.project__custom__rating

  prepare_decision_tables:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: activate_decision_tables
        when: org_config.scratch

  prepare_price_adjustment_schedules:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: activate_price_adjustment_schedules
        when: org_config.scratch

  prepare_procedureplans:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deploy_post_procedureplans
        when: project_config.project__custom__tso and project_config.project__custom__procedureplans
      2:
        task: assign_permission_sets
        when: project_config.project__custom__tso and project_config.project__custom__procedureplans
        options:
          api_names: *ps_procedureplans
      
  prepare_constraints:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deploy_post_constraints
        when: project_config.project__custom__constraints
      2:
        task: insert_qb_constraints_product_data
        when: project_config.project__custom__constraints and project_config.project__custom__qb
      3:
        task: insert_qb_constraints_component_data
        when: project_config.project__custom__constraints and project_config.project__custom__qb

  prepare_guidedselling:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_qb_guidedselling_data
        when: project_config.project__custom__guidedselling and project_config.project__custom__qb
      2:
        task: deploy_post_guidedselling
        when: project_config.project__custom__guidedselling
      
