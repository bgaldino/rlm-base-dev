minimum_cumulusci_version: "4.0.0"
orgs:
  scratch:
    beta:
      config_file: orgs/beta.json
      days: 30
    dev-sb0:
      config_file: orgs/dev-sb0.json
      days: 30
    tfid:
      config_file: orgs/tfid.json
      days: 30
    tfid-cdo:
      config_file: orgs/tfid-cdo.json
      days: 30
    tfid-cdo-rlm:
      config_file: orgs/tfid-cdo-rlm.json
      days: 30
    tfid-sdo:
      config_file: orgs/tfid-sdo.json
      days: 30
    tfid-dev:
      config_file: orgs/tfid-dev.json
      days: 30
    dev_preview:
      config_file: orgs/dev_preview.json
      days: 30
    dev_previous:
      config_file: orgs/dev_previous.json
      days: 30
    dev_datacloud:
      config_file: orgs/dev_datacloud.json
      days: 30

project:
  name: rlm-base
  package:
    name: rlm-base
    api_version: "64.0"
  git:
    default_branch: "main"
  source_format: sfdx

  custom:
    prm: true
    tso: true
    qb: true
    q3: false
    calmdelete: true
    tax: true
    billing: true
    clm: false
    dro: true
    rating: true
    rates: true
    ramps: true
    einstein: true
    product_dataset: qb
    qbrix: true
    agents: true
    refresh: false
    commerce: false
    quantumbit: true
    breconfig: false
    docgen: true

    rlm_psl_api_names: &rlm_psl_api_names
      - BREDesigner
      - BRERuntime
      - ClauseManagementUser
      - ContractManagementUser
      - ContractsAIUserPsl
      - CorePricingDesignTime
      - DataProcessingEnginePsl
      - DecimalQuantityDesigntimePsl
      - DecimalQuantityRuntimePsl
      - DocGenDesignerPsl
      - DocumentBuilderUserPsl
      - DynamicRevenueOrchestratorUserPsl
      - IndustriesConfiguratorPsl
      - Microsoft365WordPsl
      - ObligationManagementUser
      - OmniStudioDesigner
      - ProductCatalogManagementAdministratorPsl
      - ProductDiscoveryUserPsl
      - RatingDesignTimePsl
      - RatingRunTimePsl
      - RevenueLifecycleManagementUserPsl
      - RevLifecycleMgmtBillingPsl
      - UsageDesignTimePsl
      - UsageRunTimePsl
      - WalletManagementUserPsl
      - BillingAdvancedPsl
      - IndustriesARCPsl
      - CollectionsAndRecoveryPsl

    rlm_ai_psg_api_names: &rlm_ai_psg_api_names
      - CopilotSalesforceUserPSG
      - CopilotSalesforceAdminPSG

    rlm_ai_psl_api_names: &rlm_ai_psl_api_names
      - AgentforceServiceAgentBuilderPsl
      - AIAcceleratorPsl
      - EinsteinAnalyticsPlusPsl
      - EinsteinDisclsAndCmplHubUserPsl
      - EinsteinGPTCopilotPsl
      - EinsteinGPTPromptTemplatesPsl
      - MySearchPsl
      - RevenueIntelligencePsl
      - ScoringFrameworkPsl

    rlm_tableaunext_psl_api_names: &rlm_tableaunext_psl_api_names
      - TableauEinsteinUserPsl

    rlm_tableaunext_ps_api_names: &rlm_tableaunext_ps_api_names
      - TableauEinsteinAdmin
      - TableauEinsteinBusinessUser
      - TableauEinsteinAnalyst
      - TableauSelfServiceAnalyst

    rlm_ai_ps_api_names: &rlm_ai_ps_api_names
      - EinsteinGPTPromptTemplateManager
      - SalesCloudEinsteinAll

    rlm_tso_psl_api_names: &rlm_tso_psl_api_names
      - AutomatedActionsPsl
      - EinsteinAgentCWUPsl
      - EinsteinAgentPsl
      - EinsteinCopilotReviewMyDayPsl
      - EinsteinDiscoveryInTableauPsl
      - EinsteinGPTCallExplorerPsl
      - EinsteinGPTCreateClosePlanPsl
      - EinsteinGPTGetProductPricingPsl
      - EinsteinGPTGroundingStructuredDataPsl
      - EinsteinGPTMeetingFollowUpPsl
      - EinsteinGPTSalesCallSummariesPsl
      - EinsteinGPTSalesEmailsPsl
      - EinsteinGPTSalesMiningPsl
      - EinsteinGPTSalesSummariesPsl
      - EinsteinGPTSendMeetingRequestPsl
      - EinsteinSalesGenerativeInsightsPsl
      - EinsteinSalesRepFeedbackPsl
      - ERIPlatformBasic
      - SalesActionFindPastCollaboratorsPsl
      - SalesActionReviewBuyingCommitteePsl
      - SalesCloudUnlimitedAnalyticsAdminPsl
      - SalesCloudUnlimitedPsl
      - SalesEngagementBasicPsl

    rlm_tso_psg_api_names: &rlm_tso_psg_api_names
      - CopilotSalesforceUserPSG
      - CopilotSalesforceAdminPSG

    rlm_tso_ps_api_names: &rlm_tso_ps_api_names
      - EinsteinGPTSalesSummaries
      - EinsteinGPTSalesEmails
      - EinsteinGPTSalesCallSummaries
      - EinsteinGPTGetProductPricing
      - ERIBasic

    rlm_pcm_ps_api_names: &rlm_pcm_ps_api_names
      - AdvancedCsvDataImport
      - IndustriesConfiguratorPlatformApi
      - ProductConfigurationRulesDesigner
      - ProductCatalogManagementAdministrator
      - ProductCatalogManagementViewer

    rlm_blng_ps_api_names: &rlm_blng_ps_api_names
      - AnalyticsStoreUser
      - RevenueLifecycleManagementAccountingAdmin
      - RevenueLifecycleManagementBillingAdmin
      - RevenueLifecycleManagementBillingCreateInvoiceFromBillingScheduleApi
      - RevenueLifecycleManagementBillingCreditMemoOperations
      - RevenueLifecycleManagementBillingInvoiceErrorRecoveryApi
      - RevenueLifecycleManagementBillingOperations
      - RevenueLifecycleManagementBillingTaxAdmin
      - RevenueLifecycleManagementBillingVoidPostedInvoiceApi
      - RevenueLifecycleManagementCreateBillingScheduleFromBillingTransactionApi

    rlm_clm_psl_api_names: &rlm_clm_psl_api_names
      - ClauseManagementUser
      - CLMAnalyticsPsl
      - ContractManagementUser
      - ContractsAIUserPsl
      - DisclosureAndComplianceHubUserPsl
      - DocGenDesignerPsl
      - DocumentBuilderUserPsl
      - InsightsCGAnalyticsPsl
      - Microsoft365WordPsl
      - NLPServicePsl
      - ObligationManagementUser
      - OmniStudioDesigner
      - ScoringFrameworkPsl

    rlm_psg_api_names: &rlm_psg_api_names
      - RLM_CLM
      - RLM_DRO
      - RLM_NGP
      - RLM_PSL
      - RLM_BLNG
      - RLM_PCM
      - RLM_USG
      - RLM_CFG

    ps_quantumbit: &ps_quantumbit
      - RLM_QuantumBit
      - DocumentBuilderUser
      - RevLifecycleManagementUsageDesignUser

    ps_calmdelete: &ps_calmdelete
      - RLM_CALM_SObject_Access

    dt_rating_decision_tables: &dt_rating_decision_tables
      - Asset_Rate_Card_Entry_Resolution
      - Asset_Rate_Decision_Table
      - Asset_Tier_based_Rate_Adjustment
      - Asset_Volume_based_Rate_Adjustment
      - Attribute_based_Rate_Adjustment_by_Rate_Card_Entry_ID
      - Binding_Object_Rate_Card_Entry_Resolution
      - Binding_Object_Rate_Decision_Table
      - Binding_Object_Tier_based_Rate_Adjustment
      - Binding_Object_Volume_based_Rate_Adjustment
      - Rate_Adjustment_by_Attribute_Entries_2
      - Rate_Adjustment_by_Tier_Entries_2
      - Rate_Adjustment_by_Volume_Entries_2
      - Rate_Card_Entries_2
      - Tier_based_Rate_Adjustment_by_Rate_Card_Entry_ID
      - Volume_based_Rate_Adjustment_by_Rate_Card_Entry_ID

    dt_rating_discovery_decision_tables: &dt_rating_discovery_decision_tables
      - Binding_Object_Rate_Adjustment_Resolution_Entries
      - Binding_Object_Rate_Card_Entry_Resolution_Entries
      - Pricebook_Rate_Card_Decision_Table
      - Rate_Adjustment_by_Attribute_Resolution_Decision_Table
      - Rate_Adjustment_by_Tier_Resolution_Decision_Table
      - Rate_Card_Entry_Resolution_Entries_2

    dt_default_pricing_decision_tables: &dt_default_pricing_decision_tables
      - Attribute_Based_Adjustment_Decision_Table
      - Bundle_Based_Adjustment_Decision_Table
      - Contract_Pricing_Adjustment_Tiers
      - Contract_Pricing_Entries_Decision_Table
      - Contract_Pricing_Volume_Tiers
      - Price_Adjustment_Tier_Decision_Table
      - Price_Book_Entry_Decision_Table_v2
      - Tiered_Adjustment_Tier_Decision_Table

    dt_asset_decision_tables: &dt_asset_decision_tables
      - Asset_Action_Source_Entries_Decision_Table_V2
      - Asset_Rate_Card_Entry_Resolution
      - Asset_Rate_Decision_Table
      - Asset_Tier_based_Rate_Adjustment
      - Asset_Volume_based_Rate_Adjustment

    dt_pricing_discovery_decision_tables: &dt_pricing_discovery_decision_tables
      - Asset_Action_Source_Entries_Decision_Table_V2
      - Derived_Pricing_Entries_Decision_Table
  
    asset_context_name: &asset_context_name RLM_AssetContext
    asset_context_default_mapping: &asset_context_default_mapping AssetEntitiesMapping

    sales_transaction_context_name: &sales_transaction_context_name RLM_SalesTransactionContext
    sales_transaction_context_default_mapping: &sales_transaction_context_default_mapping SalesTransaction

    product_discovery_context_name: &product_discovery_context_name RLM_ProductDiscoveryContext
    product_discovery_context_default_mapping: &product_discovery_context_default_mapping ProductDiscoveryMapping

    cart_context_name: &cart_context_name RLM_CommerceCartContext
    cart_context_default_mapping: &cart_context_default_mapping CommerceCartMapping

    billing_context_name: &billing_context_name RLM_BillingContext
    billing_context_default_mapping: &billing_context_default_mapping BSGEntitiesMapping

    fulfillment_asset_context_name: &fulfillment_asset_context_name RLM_FulfillmentAssetContext
    fulfillment_asset_context_default_mapping: &fulfillment_asset_context_default_mapping FulfillAssetEntitiesMapping

    contracts_context_name: &contracts_context_name RLM_ContractsContext
    contracts_context_default_mapping: &contracts_context_default_mapping ContractsMapping

    collection_plan_segment_context_name: &collection_plan_segment_context_name RLM_CollectionPlanSegmentCtx
    collection_plan_segment_context_default_mapping: &collection_plan_segment_context_default_mapping CollectionPlanContextMapping

    rate_management_context_name: &rate_management_context_name RLM_RateManagementContext
    rate_management_context_default_mapping: &rate_management_context_default_mapping DefaultUsageMapping

    rating_discovery_context_name: &rating_discovery_context_name RLM_RatingDiscoveryContext
    rating_discovery_context_default_mapping: &rating_discovery_context_default_mapping CatalogMapping

    quantumbit_product_dataset: &quantumbit_product_dataset "datasets/sfdmu/qb-multicurrency"
    quantumbit_billing_dataset: &quantumbit_billing_dataset "datasets/sfdmu/qb-billing"
    quantumbit_dro_dataset: &quantumbit_dro_dataset "datasets/sfdmu/qb-dro"
    quantumbit_tax_dataset: &quantumbit_tax_dataset "datasets/sfdmu/qb-tax"
    quantumbit_rating_dataset: &quantumbit_rating_dataset "datasets/sfdmu/qb-rating-256"
    quantumbit_rates_dataset: &quantumbit_rates_dataset "datasets/sfdmu/qb-rates"
    quantumbit_constraints_dataset: &quantumbit_constraints_dataset "datasets/sfdmu/qb-constraints"

    sleep_default: &sleep_default 30

tasks:
  robot:
    options:
      suites: robot/rlm-base/tests
      options:
        outputdir: robot/rlm-base/results

  robot_testdoc:
    options:
      path: robot/rlm-base/tests
      output: robot/rlm-base/doc/rlm-base_tests.html

  run_tests:
    options:
      required_org_code_coverage_percent: 75

  sync_pricing_data:
    description: Sync Pricing Data
    class_path: tasks.rlm_sync_pricing_data.SyncPricingData
    group: Revenue Lifecycle Management

  extend_stdctx_contracts:
    description: Extend Standard Contracts Context Definition
    class_path: tasks.extend_stdctx_contracts.ExtendStandardContextContracts
    group: Revenue Lifecycle Management

  extend_stdctx_contracts_extraction:
    description: Extend Standard Contracts Extraction Context Definition
    class_path: tasks.extend_stdctx_contracts_extraction.ExtendStandardContextContractsExtraction
    group: Revenue Lifecycle Management

  extend_context_asset:
    group: Revenue Lifecycle Management
    description: Extend Standard Asset Context
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *asset_context_name
      description: "Extension of Standard Sales Transaction Context Definition"
      developerName: *asset_context_name
      baseReference: "AssetContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *asset_context_default_mapping

  extend_context_sales_transaction:
    group: Revenue Lifecycle Management
    description: Extend Standard Sales Transaction Context
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *sales_transaction_context_name
      description: "Extension of Standard Sales Transaction Context Definition"
      developerName: *sales_transaction_context_name
      baseReference: "SalesTransactionContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *sales_transaction_context_default_mapping

  extend_context_product_discovery:
    description: Extend Standard Product Discovery Context
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *product_discovery_context_name
      description: "Extension of Standard Product Discovery Context Definition"
      developerName: *product_discovery_context_name
      baseReference: "ProductDiscoveryContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *product_discovery_context_default_mapping

  extend_context_cart:
    description: Extend Standard Cart Context
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *cart_context_name
      description: "Extension of Standard Cart Context Definition"
      developerName: *cart_context_name
      baseReference: "CommerceCartContextDefinition__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *cart_context_default_mapping  

  extend_context_billing:
    description: Extend Standard Billing Context
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *billing_context_name
      description: "Extension of Standard Billing Context Definition"
      developerName: *billing_context_name
      baseReference: "BillingContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *billing_context_default_mapping

  extend_context_fulfillment_asset:
    description: Extend Standard Fulfillment Asset Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *fulfillment_asset_context_name
      description: "Extension of Standard Fulfillment Asset Context Definition"
      developerName: *fulfillment_asset_context_name
      baseReference: "FulfillmentAssetContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *fulfillment_asset_context_default_mapping

  extend_context_collection_plan_segment:
    description: Extend Standard Collection Plan Segment Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *collection_plan_segment_context_name
      description: "Extension of Standard Collection Plan Segment Context Definition"
      developerName: *collection_plan_segment_context_name
      baseReference: "CollectionPlanSegmentContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *collection_plan_segment_context_default_mapping

  extend_context_rate_management:
    description: Extend Standard Rate Management Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *rate_management_context_name
      description: "Extension of Standard Rate Management Context Definition"
      developerName: *rate_management_context_name
      baseReference: "RateManagementContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *rate_management_context_default_mapping

  extend_context_rating_discovery:
    description: Extend Standard Rating Discovery Context Definition
    group: Revenue Lifecycle Management
    class_path: tasks.rlm_extend_stdctx.ExtendStandardContext
    options:
      name: *rating_discovery_context_name
      description: "Extension of Standard Rating Discovery Context Definition"
      developerName: *rating_discovery_context_name
      baseReference: "RatingDiscoveryContext__stdctx"
      startDate: "2020-01-01T00:00:00.000Z"
      contextTtl: 20
      defaultMapping: *rating_discovery_context_default_mapping

  deploy_context_definitions:
    description: Context Definitions need to be deployed and activated before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/contextDefinitions

  deploy_permissions:
    description: Runs deployment against the permission set group file for Revenue Cloud.
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/permissionsetgroups

  deploy_decision_tables:
    description: Decision Tables are required to be deployed first before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/decisionTables

  deploy_agents_genAiPlanners:
    description: Decision Tables are required to be deployed first before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/genAiPlannerBundles

  deploy_agents_genAiFunctions:
    description: Decision Tables are required to be deployed first before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/genAiFunctions

  deploy_agents_genAiPlugins:
    description: Decision Tables are required to be deployed first before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/genAiPlugins

  deploy_agents_flows:
    description: Decision Tables are required to be deployed first before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/flows

  deploy_agents_settings:
    description: Decision Tables are required to be deployed first before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: unpackaged/post_agents/settings

  deploy_expression_sets:
    description: Expression Sets need to be deployed and activated before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/expressionSetDefinition
      transforms:
        - transform: find_replace
          options:
            patterns:
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__ATTRIBUTEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Attribute Based Adjustment' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__VOLUMEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Price Adjustment Tier' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__BUNDLEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Bundle Based Adjustment' LIMIT 1
                api: rest

  activate_and_deploy_expression_sets:
    description: Expression Sets need to be deployed and activated before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/expressionSetDefinition
      transforms:
        - transform: find_replace
          options:
            patterns:
              - xpath: //ExpressionSetDefinition/versions/status[text()="Draft"]
                replace: Active
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__ATTRIBUTEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Attribute Based Adjustment' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__VOLUMEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Price Adjustment Tier' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__BUNDLEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Bundle Based Adjustment' LIMIT 1
                api: rest

  deploy_full:
    description: Deploy all metadata
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default
      transforms:
        - transform: find_replace
          options:
            patterns:
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__ATTRIBUTEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Attribute Based Adjustment' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__VOLUMEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Price Adjustment Tier' LIMIT 1
                api: rest
              - xpath: //ExpressionSetDefinition/versions/variables/value[text()="__BUNDLEPasID__"]
                replace_record_id_query: SELECT Id from PriceAdjustmentSchedule WHERE name = 'Standard Bundle Based Adjustment' LIMIT 1
                api: rest

  deploy_org_settings:
    description: Org Settings need to be deployed and activated before other metadata -- this prioritizes this deployment first
    class_path: cumulusci.tasks.salesforce.Deploy
    group: Revenue Lifecycle Management
    options:
      path: force-app/main/default/settings

  createPartnerCentral:
    class_path: cumulusci.tasks.salesforce.CreateCommunity
    options:
      name: "rlm"
      description: "RLM Partner Digital Experience"
      template: "Build Your Own"
      skip_existing: true

  create_price_adjustment_schedules:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/pas"

  create_price_adjustment_schedules_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/pas"

  insert_quantumbit_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_product_dataset

  insert_quantumbit_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_product_dataset

  insert_q3_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-multicurrency"

  insert_q3_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-multicurrency"

  insert_clm_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/test-clm"

  insert_clm_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/clm"

  insert_qb_dro_data_scratch:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/qb-dro_scratch"

  insert_qb_dro_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_dro_dataset

  insert_q3_dro_data_scratch:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-dro_scratch"

  insert_q3_dro_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-dro"

  insert_tax_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_tax_dataset

  insert_tax_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_tax_dataset

  insert_q3_tax_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-tax"

  insert_q3_tax_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-tax"

  insert_billing_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_billing_dataset

  insert_billing_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_billing_dataset

  insert_q3_billing_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-billing"

  insert_q3_billing_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-billing"

  insert_qb_rating_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rating_dataset

  insert_qb_rating_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rating_dataset
  
  insert_q3_rating_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-rating"

  insert_q3_rating_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-rating"

  insert_qb_rates_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rates_dataset

  insert_qb_rates_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_rates_dataset

  insert_q3_rates_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-rates"

  insert_q3_rates_data_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/q3-rates"

  insert_scratch_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/scratch_data"

  insert_qb_constraints_data:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: *quantumbit_constraints_dataset
  
  activate_decision_tables:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/decision_tables_active"

  activate_expression_sets:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_active"

  activate_expression_sets_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_active"

  deactivate_expression_sets:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_inactive"

  deactivate_expression_sets_prod:
    class_path: tasks.rlm_sfdmu.LoadSFDMUData
    options:
      pathtoexportjson: "datasets/sfdmu/expressionsets_inactive"

  deploy_sharing_rules:
    class_path: cumulusci.tasks.salesforce.DeployBundles
    options:
      path: unpackaged/post_sharing

  deploy_quantumbit:
    class_path: cumulusci.tasks.salesforce.DeployBundles
    options:
      path: unpackaged/post_quantumbit

  deploy_post_scratch:
    class_path: cumulusci.tasks.salesforce.DeployBundles
    options:
      path: unpackaged/post_scratch

  deploy_post_prm:
    class_path: cumulusci.tasks.salesforce.DeployBundles
    options:
      path: unpackaged/post_prm

  deploy_post_docgen:
    class_path: cumulusci.tasks.salesforce.DeployBundles
    options:
      path: unpackaged/post_docgen

  deploy_post_constraints:
    class_path: cumulusci.tasks.salesforce.DeployBundles
    options:
      path: unpackaged/post_constraints

  create_rule_library:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createRuleLibrary.apex

  create_docgen_library:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createDocgenTemplateLibrary.apex

  create_dro_rule_library:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createDRORuleLibrary.apex

  create_tax_engine:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/createTaxEngine.apex

  activate_default_payment_term:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateDefaultPaymentTerm.apex

  activate_billing_records:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateBillingRecords.apex

  activate_tax_records:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateTaxRecords.apex

  activate_price_adjustment_schedules:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activatePriceAdjustmentSchedules.apex

  activate_rating_records:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateRatingRecords.apex

  activate_rates:
    class_path: cumulusci.tasks.apex.anon.AnonymousApexTask
    options:
      path: scripts/apex/activateRateCardEntries.apex

  refresh_dt_rating:
    group: Revenue Lifecycle Management
    description: Refresh Rating Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_rating_decision_tables

  refresh_dt_rating_discovery:
    group: Revenue Lifecycle Management
    description: Refresh Rating Discovery Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_rating_discovery_decision_tables

  refresh_dt_default_pricing:
    group: Revenue Lifecycle Management
    description: Refresh Rating Discovery Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_default_pricing_decision_tables

  refresh_dt_pricing_discovery:
    group: Revenue Lifecycle Management
    description: Refresh Pricing Discovery Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_pricing_discovery_decision_tables

  refresh_dt_asset:
    group: Revenue Lifecycle Management
    description: Refresh Asset Decision Tables
    class_path: tasks.rlm_refresh_decision_table.RefreshDecisionTable
    options:
      developerNames: *dt_asset_decision_tables

  load_sfdmu_data:
    group: Revenue Lifecycle Management
    description: Load SFDMU Data
    class_path: tasks.rlm_sfdmu.LoadSFDMUData

flows:
  prepare_rlm_org:
    group: Revenue Lifecycle Management
    steps:
      1:
        flow: prepare_core
      2:
        flow: prepare_decision_tables
      4:
        flow: prepare_expression_sets
      5:
        task: createPartnerCentral
        when: project_config.project__custom__prm
      6:
        task: deploy_full
      7:
        flow: prepare_product_data
      8:
        flow: prepare_price_adjustment_schedules
      9:
        flow: prepare_scratch
      10:
        flow: prepare_quantumbit
      11:
        flow: prepare_dro
      12:
        flow: prepare_tax
      13:
        flow: prepare_billing
      14:
        flow: prepare_clm
      15:
        flow: prepare_rating
      16:
        task: activate_and_deploy_expression_sets
      17:
        flow: prepare_agents
      18:
        flow: prepare_prm
      19:
        flow: prepare_tso
      20:
        flow: prepare_docgen
      21:
        flow: refresh_all_decision_tables
         
  prepare_core:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: assign_permission_set_licenses
        options:
          api_names: *rlm_psl_api_names
      2:
        task: deploy_pre
      3:
        task: assign_permission_set_licenses
        when: project_config.project__custom__clm
        options:
          api_names: *rlm_clm_psl_api_names
      4:
        task: assign_permission_set_licenses
        when: project_config.project__custom__einstein
        options:
          api_names: *rlm_ai_psl_api_names  
      5:
        task: util_sleep
        options:
          seconds: *sleep_default
      6:
        task: assign_permission_set_groups
        options:
          api_names: *rlm_psg_api_names
      7:
        task: assign_permission_sets
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_pcm_ps_api_names
      8:
        flow: extend_context_definitions
      9:
        task: util_sleep
        options:
          seconds: *sleep_default
      10:
        task: create_price_adjustment_schedules
        when: org_config.scratch
      11:
        task: create_price_adjustment_schedules_prod
        when: not org_config.scratch and project_config.project__custom__tso
      12:
        task: util_sleep
        options:
          seconds: *sleep_default
      13:
        task: create_rule_library
        when: project_config.project__custom__breconfig
      14:
        task: util_sleep
        options:
          seconds: *sleep_default
      15:
        task: create_dro_rule_library
        when: project_config.project__custom__dro
      16:
        task: assign_permission_sets
        when: project_config.project__custom__einstein
        options:
          api_names: *rlm_ai_ps_api_names
      17:
        task: assign_permission_sets
        when: project_config.project__custom__billing
        options:
          api_names: *rlm_blng_ps_api_names

  extend_context_definitions:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: extend_context_sales_transaction
      2:
        task: extend_context_product_discovery
      3:
        task: extend_context_cart
        when: project_config.project__custom__commerce
      4:
        task: extend_context_billing
        when: project_config.project__custom__billing
      5:
        task: extend_context_collection_plan_segment
        when: project_config.project__custom__billing
      6:
        task: extend_context_fulfillment_asset
        when: project_config.project__custom__dro
      7:
        task: extend_stdctx_contracts
        when: project_config.project__custom__clm
      8:
        task: extend_stdctx_contracts_extraction
        when: project_config.project__custom__clm
      9:
        task: extend_context_rate_management
        when: project_config.project__custom__rating
      10:
        task: extend_context_rating_discovery
        when: project_config.project__custom__rating
      11:
        task: extend_context_asset

  prepare_expression_sets:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deactivate_expression_sets
        when: org_config.scratch
      2:
        task: deactivate_expression_sets_prod
        when: not org_config.scratch
      3:
        task: deploy_expression_sets
        when: org_config.scratch
  
  prepare_product_data:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_quantumbit_data
        when: org_config.scratch and project_config.project__custom__qb
      2:
        task: insert_quantumbit_data_prod
        when: not org_config.scratch and project_config.project__custom__qb
      3:
        task: insert_q3_data
        when: org_config.scratch and project_config.project__custom__q3
      4:
        task: insert_q3_data_prod
        when: not org_config.scratch and project_config.project__custom__q3

  prepare_scratch:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_scratch_data
        when: org_config.scratch and not project_config.project__custom__tso
      2:
        task: deploy_post_scratch
        when: org_config.scratch and not project_config.project__custom__tso

  prepare_quantumbit:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deploy_quantumbit
        when: project_config.project__custom__quantumbit
      2:
        task: assign_permission_sets
        when: project_config.project__custom__quantumbit
        options:
          api_names: *ps_quantumbit
      3:
        task: assign_permission_sets
        when: project_config.project__custom__quantumbit and project_config.project__custom__calmdelete
        options:
          api_names: *ps_calmdelete

  prepare_tso:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: assign_permission_set_licenses
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_tso_psl_api_names
      2:
        task: assign_permission_set_groups
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_tso_psg_api_names
      3:
        task: assign_permission_sets
        when: project_config.project__custom__tso
        options:
          api_names: *rlm_tso_ps_api_names

  prepare_dro:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_qb_dro_data_scratch
        when: org_config.scratch and project_config.project__custom__dro and project_config.project__custom__qb
      2:
        task: insert_qb_dro_data_prod
        when: not org_config.scratch and project_config.project__custom__dro and project_config.project__custom__qb
      3:
        task: insert_q3_dro_data_scratch
        when: org_config.scratch and project_config.project__custom__dro and project_config.project__custom__q3
      4:
        task: insert_q3_dro_data_prod
        when: not org_config.scratch and project_config.project__custom__dro and project_config.project__custom__q3

  prepare_clm:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_clm_data
        when: org_config.scratch and project_config.project__custom__clm
      2:
        task: insert_clm_data_prod
        when: not org_config.scratch and project_config.project__custom__clm

  prepare_docgen:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: create_docgen_library
      2:
        task: deploy_post_docgen

  prepare_billing:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_billing_data
        when: org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__qb
      2:
        task: insert_billing_data_prod
        when: not org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__qb
      3:
        task: insert_q3_billing_data
        when: org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__q3
      4:
        task: insert_q3_billing_data_prod
        when: not org_config.scratch and project_config.project__custom__billing and not project_config.project__custom__refresh and project_config.project__custom__q3
      5:
        task: activate_flow
        when: project_config.project__custom__billing
        options:
          developer_names: RLM_Order_to_Billing_Schedule_Flow
      6:
        task: activate_default_payment_term
        when: project_config.project__custom__billing
      7: 
        task: activate_billing_records
        when: project_config.project__custom__billing

  prepare_prm:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: deploy_post_prm
        when: project_config.project__custom__prm
      2:
        task: publish_community
        when: project_config.project__custom__prm
        options:
          name: rlm
      3:
        task: deploy_sharing_rules
        when: project_config.project__custom__prm

  prepare_tax:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: create_tax_engine
        when: project_config.project__custom__tax
      2:
        task: insert_tax_data
        when: org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__qb
      3:
        task: insert_tax_data_prod
        when: not org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__qb
      4:
        task: insert_q3_tax_data
        when: org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__q3
      5:
        task: insert_q3_tax_data_prod
        when: not org_config.scratch and project_config.project__custom__tax and not project_config.project__custom__refresh and project_config.project__custom__q3
      6: 
        task: activate_tax_records
        when: project_config.project__custom__tax

  prepare_rating:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: insert_qb_rating_data
        when: org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__qb
      2:
        task: insert_qb_rating_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__qb
      3:
        task: insert_q3_rating_data
        when: org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__q3
      4:
        task: insert_q3_rating_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and not project_config.project__custom__refresh and project_config.project__custom__q3
      5:
        task: insert_qb_rates_data
        when: org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__qb
      6:
        task: insert_qb_rates_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__qb
      7:
        task: insert_q3_rates_data
        when: org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__q3
      8:
        task: insert_q3_rates_data_prod
        when: not org_config.scratch and project_config.project__custom__rating and project_config.project__custom__rates and not project_config.project__custom__refresh and project_config.project__custom__q3
      9: 
        task: activate_rating_records
        when: project_config.project__custom__rating and project_config.project__custom__rates
      10: 
        task: activate_rates
        when: project_config.project__custom__rating and project_config.project__custom__rates
  
  prepare_agents:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: assign_permission_set_groups
        when: project_config.project__custom__agents
        options:
          api_names: *rlm_ai_psg_api_names
      2:
        task: deploy_agents_settings
        when: project_config.project__custom__agents
      3:
        task: deploy_agents_flows
        when: project_config.project__custom__agents
      4:
        task: deploy_agents_genAiFunctions
        when: project_config.project__custom__agents
      5:
        task: deploy_agents_genAiPlugins
        when: project_config.project__custom__agents
      6:
        task: deploy_agents_genAiPlanners
        when: project_config.project__custom__agents
  
  refresh_all_decision_tables:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: sync_pricing_data
      2:
        task: refresh_dt_pricing_discovery
      3:
        task: refresh_dt_asset
        when: project_config.project__custom__rating
      4:
        task: refresh_dt_rating
        when: project_config.project__custom__rating
      5:
        task: refresh_dt_rating_discovery
        when: project_config.project__custom__rating

  prepare_decision_tables:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: activate_decision_tables
        when: org_config.scratch

  prepare_price_adjustment_schedules:
    group: Revenue Lifecycle Management
    steps:
      1:
        task: activate_price_adjustment_schedules
        when: org_config.scratch